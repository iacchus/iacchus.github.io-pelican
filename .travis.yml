# .travis.yml

# build using Python 3.6
language: python
python:
  - 3.8
# Cache Dependencies
cache: pip
# we need two Linux packages for the optimize_images plugin
#addons:
#  apt:
#    packages:
#    - optipng
#    - libjpeg-progs

# install dependencies
install:
  - sudo apt install python git make
  - pip install --upgrade pip
  - pip install pelican
# build our blog
script:
  #- invoke publish_carefully
  - mkdir build
  - cd build
  - git clone https://github.com/iacchus/iacchus.github.io
  - git clone https://github.com/iacchus/iacchus.github.io-pelican


# deploy to GitHub pages
#deploy:
#  provider: pages
#  local_dir: ../blog.minchin.ca-master/
#  target-branch: master
#  skip_cleanup: true
#  github_token: $GITHUB_TOKEN  # Set in travis-ci.org dashboard
  # only deploy on "main" branch
  #  on:
  #  branch: pelican
  #
deploy:
  repo: iacchus/iacchus.github.io
  local_dir: ../iacchus.github.io
  target-branch: master
  provider: pages
  skip_cleanup: true
  github_token: $GITHUB_TOKEN  # Set in the settings page of your repository, as a secure variable
  keep_history: true
  on:
    branch: master
